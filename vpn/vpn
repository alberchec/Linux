#! /bin/bash

sudo openvpn --config /etc/openvpn/vpn2.ovpn --daemon
sleep 2

if ip address | grep -q "tun0"
then
  echo "Connected to SURFSHARK VPN"
  sudo rm -f /etc/resolv.conf
  #sudo ln -s /run/resolvconf/resolv.conf /etc/resolv.conf
  sudo cp /etc/resolv2.conf /etc/resolv.conf
  echo "$(cat /etc/resolv.conf | grep 'nameserver')"
  echo $'\n'
  echo "$(cat /run/resolvconf/resolv.conf | grep 'nameserver')"
  sudo ufw enable
  export iproutevalue=$(ip route | grep default)
  sudo ip route del $iproutevalue
  echo "Running DNS leak test"
  sleep 5
  dnstest
else
  echo "Connection failed"
  sudo killall openvpn
fi
